# Pianki - Ankiå¡ç‰‡åˆ¶ä½œå·¥å…·

ä¸€ä¸ªç°ä»£åŒ–çš„Ankiå¡ç‰‡åˆ¶ä½œWebåº”ç”¨ï¼Œæ”¯æŒMarkdownæ ¼å¼ã€å®æ—¶é¢„è§ˆã€å›¾ç‰‡æ’å…¥ï¼Œå¯å¯¼å‡ºä¸ºæ ‡å‡†.apkgæ ¼å¼ã€‚

![Version](https://img.shields.io/badge/version-0.1.18-blue)
![License](https://img.shields.io/badge/license-MIT-green)
![Platform](https://img.shields.io/badge/platform-Windows%20%7C%20macOS%20%7C%20Linux-lightgrey)

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ“‹ Markdownç¼–è¾‘å™¨ï¼ˆå®æ—¶é¢„è§ˆï¼‰
- **å·¦å³åˆ†æ è®¾è®¡**ï¼šå·¦ä¾§ç¼–è¾‘ï¼Œå³ä¾§å®æ—¶é¢„è§ˆ
- æ”¯æŒæ ‡å‡†Markdownè¯­æ³•ï¼ˆç²—ä½“ã€æ–œä½“ã€æ ‡é¢˜ã€åˆ—è¡¨ç­‰ï¼‰
- å·¥å…·æ å¿«æ·æŒ‰é’®ï¼ˆç²—ä½“ã€æ–œä½“ã€ä»£ç ã€å›¾ç‰‡ï¼‰
- æ”¯æŒè¡¨æ ¼ã€å¼•ç”¨ã€ä»£ç å—ç­‰é«˜çº§æ ¼å¼
- æ‰€è§å³æ‰€å¾—çš„ç¼–è¾‘ä½“éªŒ

### ğŸ–¼ï¸ çµæ´»çš„å›¾ç‰‡å¤„ç†
- **æ–¹å¼1**ï¼šç‚¹å‡»å·¥å…·æ "ğŸ“· æ’å…¥å›¾ç‰‡"æŒ‰é’®
- **æ–¹å¼2**ï¼šç›´æ¥åœ¨ç¼–è¾‘å™¨ä¸­æŒ‰ Ctrl+V (Mac: Cmd+V) ç²˜è´´
- å›¾ç‰‡è‡ªåŠ¨æ’å…¥åˆ°å…‰æ ‡ä½ç½®
- ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œæ›´ç®€æ´å¯ç§»æ¤
- æ”¯æŒæ–‡å­—ä¸å›¾ç‰‡æ··æ’
- æ”¯æŒæ ¼å¼ï¼šJPGã€PNGã€GIFã€WebP

### ğŸ’¾ æ•°æ®ç®¡ç†
- å¤šç‰Œç»„æ”¯æŒ
- å¡ç‰‡åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤
- å®æ—¶æ›´æ–°å¡ç‰‡è®¡æ•°
- è½»é‡çº§ JSON æ–‡ä»¶æ•°æ®åº“
- è‡ªåŠ¨æ•°æ®æŒä¹…åŒ–
- .apkg æ–‡ä»¶å¯¼å…¥/å¯¼å‡º

### ğŸ“¦ Ankiå¯¼å‡º
- å¯¼å‡ºä¸ºæ ‡å‡† .apkg æ ¼å¼
- å®Œç¾æ”¯æŒMarkdownè½¬HTML
- è‡ªåŠ¨æ‰“åŒ…å›¾ç‰‡èµ„æº
- å…¼å®¹Android/Desktop Anki

### ğŸ¨ ç°ä»£åŒ–UI
- ç¾è§‚çš„ç¡®è®¤å¯¹è¯æ¡†ï¼ˆæ›¿ä»£æµè§ˆå™¨é»˜è®¤å¼¹çª—ï¼‰
- å“åº”å¼è®¾è®¡
- æµç•…çš„åŠ¨ç”»æ•ˆæœ
- ç®€æ´ç›´è§‚çš„ç•Œé¢

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
npm install
```

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# åŒæ—¶å¯åŠ¨å‰ç«¯å’Œåç«¯
npm run dev
```

è®¿é—® http://localhost:3000/ å¼€å§‹ä½¿ç”¨ï¼

### å…¶ä»–å‘½ä»¤

```bash
# ä»…å¯åŠ¨åç«¯
npm run dev:backend

# ä»…å¯åŠ¨å‰ç«¯
npm run dev:frontend

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
npm start
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### å‰ç«¯
- **æ¡†æ¶**: React 18 + TypeScript
- **æ„å»ºå·¥å…·**: Vite
- **Markdown**: react-markdown + remark-gfm
- **HTTPå®¢æˆ·ç«¯**: Axios

### åç«¯
- **è¿è¡Œæ—¶**: Node.js + Express + TypeScript
- **æ•°æ®åº“**: è‡ªå®šä¹‰ JSON æ•°æ®åº“ï¼ˆåŸºäº fs/promisesï¼‰
- **æ–‡ä»¶ä¸Šä¼ **: Multer
- **Markdownå¤„ç†**: Marked
- **Anki å¯¼å…¥/å¯¼å‡º**: anki-apkg-export + sql.js

### æ¡Œé¢åº”ç”¨ï¼ˆTauriï¼‰
- **æ¡†æ¶**: Tauri 2.x
- **æ¶æ„**: Sidecar æ¨¡å¼ï¼ˆNode.js åç«¯ä½œä¸ºç‹¬ç«‹è¿›ç¨‹ï¼‰
- **æ‰“åŒ…å·¥å…·**: @yao-pkg/pkg
- **å¹³å°æ”¯æŒ**: Windows, macOS, Linux

## ğŸ“– ä½¿ç”¨è¯´æ˜

### åˆ›å»ºå¡ç‰‡

1. é€‰æ‹©æˆ–åˆ›å»ºä¸€ä¸ªç‰Œç»„
2. ç‚¹å‡»"â• æ–°å»ºå¡ç‰‡"æŒ‰é’®
3. åœ¨å·¦å³åˆ†æ çš„Markdownç¼–è¾‘å™¨ä¸­ç¼–è¾‘å†…å®¹ï¼š
   - **å·¦ä¾§**ï¼šè¾“å…¥Markdownæ ¼å¼æ–‡æœ¬
   - **å³ä¾§**ï¼šå®æ—¶é¢„è§ˆæ¸²æŸ“æ•ˆæœ
4. æ’å…¥å›¾ç‰‡ï¼š
   - ç‚¹å‡»å·¥å…·æ "ğŸ“· æ’å…¥å›¾ç‰‡"
   - æˆ–ç›´æ¥ç²˜è´´å‰ªè´´æ¿ä¸­çš„å›¾ç‰‡
5. ç‚¹å‡»"ä¿å­˜"

### å¯¼å‡ºåˆ°Anki

1. é€‰æ‹©è¦å¯¼å‡ºçš„ç‰Œç»„
2. ç‚¹å‡»"ğŸ“¦ å¯¼å‡ºä¸º .apkg"æŒ‰é’®
3. æ¡Œé¢ç‰ˆä¼šå¼¹å‡ºâ€œä¿å­˜æ–‡ä»¶â€å¯¹è¯æ¡†ï¼Œé€‰æ‹©ä½ç½®åè‡ªåŠ¨å†™å…¥ï¼›æµè§ˆå™¨ç‰ˆå°†ç›´æ¥ä¸‹è½½
4. åœ¨ Anki ä¸­å¯¼å…¥è¯¥æ–‡ä»¶

### Markdownè¯­æ³•ç¤ºä¾‹

```markdown
# ä¸€çº§æ ‡é¢˜
## äºŒçº§æ ‡é¢˜

**ç²—ä½“æ–‡å­—** *æ–œä½“æ–‡å­—* ~~åˆ é™¤çº¿~~

- åˆ—è¡¨é¡¹ 1
- åˆ—è¡¨é¡¹ 2

> å¼•ç”¨æ–‡æœ¬

`ä»£ç ç‰‡æ®µ`

![å›¾ç‰‡](/uploads/xxx.png)
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
pianki/
â”œâ”€â”€ frontend/                 # å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/       # Reactç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ MarkdownEditor.tsx    # Markdownç¼–è¾‘å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ CardEditor.tsx        # å¡ç‰‡ç¼–è¾‘å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ CardList.tsx          # å¡ç‰‡åˆ—è¡¨
â”‚   â”‚   â”‚   â”œâ”€â”€ DeckSelector.tsx      # ç‰Œç»„é€‰æ‹©å™¨
â”‚   â”‚   â”‚   â””â”€â”€ ConfirmDialog.tsx     # ç¡®è®¤å¯¹è¯æ¡†
â”‚   â”‚   â”œâ”€â”€ App.tsx           # ä¸»åº”ç”¨
â”‚   â”‚   â”œâ”€â”€ api.ts            # APIè°ƒç”¨
â”‚   â”‚   â””â”€â”€ main.tsx          # å…¥å£æ–‡ä»¶
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ backend/                  # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ routes/           # APIè·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ cards.ts      # å¡ç‰‡è·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ decks.ts      # ç‰Œç»„è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ database.ts       # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â”‚   â”œâ”€â”€ anki-export.ts    # Ankiå¯¼å‡ºé€»è¾‘
â”‚   â”‚   â”œâ”€â”€ types.ts          # TypeScriptç±»å‹
â”‚   â”‚   â””â”€â”€ index.ts          # æœåŠ¡å™¨å…¥å£
â”‚   â”œâ”€â”€ data/                 # æ•°æ®å­˜å‚¨ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â”‚   â””â”€â”€ pianki.db         # SQLite æ•°æ®åº“
â”‚   â”œâ”€â”€ uploads/              # ä¸Šä¼ çš„å›¾ç‰‡ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â”œâ”€â”€ scripts/              # æ•°æ®è¿ç§»è„šæœ¬
â”‚   â”‚   â””â”€â”€ migrate-json-to-sqlite.ts
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ package.json              # æ ¹é…ç½®æ–‡ä»¶
â””â”€â”€ README.md                 # é¡¹ç›®æ–‡æ¡£
```

## ğŸ”§ é…ç½®è¯´æ˜

### æœåŠ¡å™¨ç«¯å£
- å¼€å‘ç¯å¢ƒï¼ˆWebï¼‰ï¼šå‰ç«¯ http://localhost:3000ï¼Œåç«¯ http://localhost:9908
- æ¡Œé¢ç‰ˆï¼ˆTauriï¼‰ï¼šåç«¯ç«¯å£è‡ªåŠ¨é€‰æ‹©ï¼Œé»˜è®¤ä» `9908` å¼€å§‹ï¼Œè‹¥å†²çªä¼šåœ¨ `9908â€“9928` ä¹‹é—´é€’å¢å°è¯•ï¼›å‰ç«¯åœ¨å¯åŠ¨æ—¶æ¥æ”¶ `backend-ready` äº‹ä»¶è‡ªåŠ¨åˆ‡æ¢åˆ°å®é™…ç«¯å£

### æ•°æ®å­˜å‚¨ä½ç½®
- æ•°æ®åº“: `backend/data/pianki.db`
- ä¸Šä¼ å›¾ç‰‡: `backend/uploads/`
- æ—§ç‰ˆ JSON å¤‡ä»½ï¼ˆè¿ç§»æ—¶è‡ªåŠ¨ç”Ÿæˆï¼‰: `backend/data/db.json.bak-*`

### å›¾ç‰‡é™åˆ¶
- æœ€å¤§æ–‡ä»¶å¤§å°: 5MB
- æ”¯æŒæ ¼å¼: JPEG, PNG, GIF, WebP

## ğŸ’¡ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°åŠŸèƒ½

1. **å‰ç«¯ç»„ä»¶**: åœ¨ `frontend/src/components/` åˆ›å»ºæ–°ç»„ä»¶
2. **APIæ¥å£**: åœ¨ `backend/src/routes/` æ·»åŠ æ–°è·¯ç”±
3. **æ•°æ®æ¨¡å‹**: åœ¨ `backend/src/types.ts` å®šä¹‰ç±»å‹

### æ•°æ®åº“æ“ä½œ

åç«¯æ•°æ®å·²è¿ç§»åˆ° SQLiteï¼Œæ‰€æœ‰è¯»å†™é€šè¿‡ä»“åº“å‡½æ•°å®Œæˆï¼Œä¾‹å¦‚ï¼š

```typescript
import { createDeck } from './db/repositories/decks';
import { createCard } from './db/repositories/cards';

const deck = createDeck({ name: 'ç¤ºä¾‹ç‰Œç»„' });
createCard({
  deck_id: deck.id,
  front_text: 'Question',
  back_text: 'Answer'
});
```

å¦‚æœä»ä¿å­˜ç€æ—§ç‰ˆ `db.json`ï¼Œå¯ä»¥æ‰§è¡Œè¿ç§»è„šæœ¬ï¼š

```bash
cd backend
npm run migrate:sqlite
```

è„šæœ¬ä¼šè‡ªåŠ¨å¤‡ä»½ JSON å¹¶å†™å…¥ `backend/data/pianki.db`ã€‚

### ç‰ˆæœ¬å‘å¸ƒæµç¨‹

1. ç¡®ä¿å·¥ä½œåŒºå¹²å‡€å¹¶å®Œæˆä»£ç å®¡æŸ¥ã€‚
2. è¿è¡Œ `npm run release -- <ç‰ˆæœ¬å·>`ï¼ˆä¾‹å¦‚ `0.1.13`ï¼‰ã€‚è¯¥è„šæœ¬ä¼šï¼š
   - è°ƒç”¨ `npm version` æ›´æ–°æ ¹ä¸å„ workspace çš„ `package.json`/`package-lock.json`
   - åŒæ­¥ `README.md`ã€`frontend/src/App.tsx`ã€`src-tauri/tauri.conf.json` ç­‰é npm æ–‡ä»¶
   - è‡ªåŠ¨æäº¤å¹¶æ¨é€ä»£ç 
   - åˆ é™¤å¹¶é‡å»º `v<ç‰ˆæœ¬å·>` tagï¼Œå†æ¨é€è§¦å‘ GitHub Actions å‘å¸ƒ
3. å¦‚æœåªéœ€æ‰‹åŠ¨åŒæ­¥é npm æ–‡ä»¶ï¼Œå¯ç”¨ `npm run bump -- <æ–°ç‰ˆæœ¬> [æ—§ç‰ˆæœ¬]`ã€‚

### Markdownåˆ°Ankiçš„è½¬æ¢æµç¨‹

1. ç”¨æˆ·åœ¨ç¼–è¾‘å™¨ä¸­è¾“å…¥Markdown
2. ä¿å­˜æ—¶ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚ `/uploads/xxx.png`ï¼‰
3. å¯¼å‡ºæ—¶ï¼š
   - æå–Markdownä¸­çš„å›¾ç‰‡é“¾æ¥
   - è¯»å–å›¾ç‰‡æ–‡ä»¶å¹¶æ·»åŠ åˆ°.apkgåŒ…
   - ä½¿ç”¨`marked`å°†Markdownè½¬æ¢ä¸ºHTML
   - ç”ŸæˆAnkiå¡ç‰‡

## ğŸ› å¸¸è§é—®é¢˜

**Q: æ•°æ®ä¿å­˜åœ¨å“ªé‡Œï¼Ÿ**
A: æ•°æ®åº“æ–‡ä»¶ä½äº `backend/data/pianki.db`ï¼Œå›¾ç‰‡ä¿å­˜åœ¨ `backend/uploads/` ç›®å½•ã€‚

**Q: å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Ÿ**
A: å¤åˆ¶ `backend/data/pianki.db` å’Œ `backend/uploads/` ç›®å½•å³å¯ï¼ˆè‹¥ä»æœ‰ `.bak` çš„ JSON æ–‡ä»¶ä¸€å¹¶å¤‡ä»½æ›´å®‰å…¨ï¼‰ã€‚

**Q: å¯¼å‡ºçš„.apkgæ–‡ä»¶åœ¨Ankiä¸­æ— æ³•æ‰“å¼€ï¼Ÿ**
A: ç¡®ä¿ï¼š
- ç‰Œç»„ä¸­è‡³å°‘æœ‰ä¸€å¼ å¡ç‰‡
- å›¾ç‰‡æ–‡ä»¶æ ¼å¼æ­£ç¡®ä¸”æœªæŸå
- Ankiç‰ˆæœ¬æ”¯æŒï¼ˆå»ºè®®2.1+ï¼‰

**Q: å¯ä»¥åŒæ—¶åˆ›å»ºå¤šä¸ªç‰Œç»„å—ï¼Ÿ**
A: å¯ä»¥ï¼ç‚¹å‡»å·¦ä¾§è¾¹æ çš„"â•"æŒ‰é’®å³å¯åˆ›å»ºæ–°ç‰Œç»„ã€‚

**Q: Markdowné¢„è§ˆå’ŒAnkiæ˜¾ç¤ºä¸€è‡´å—ï¼Ÿ**
A: åŸºæœ¬ä¸€è‡´ã€‚åº”ç”¨ä¼šå°†Markdownå‡†ç¡®è½¬æ¢ä¸ºHTMLï¼ŒåŒ…æ‹¬æ ¼å¼å’Œå›¾ç‰‡ã€‚

## ğŸ“£ åé¦ˆä¸è”ç³»

- é‚®ç®±ï¼šprehisle@gmail.com
- GitHub Issuesï¼šhttps://github.com/prehisle/pianki/issues/new/choose
- GitHub Discussionsï¼šhttps://github.com/prehisle/pianki/discussions
- QQç¾¤ï¼š188193559ï¼ˆæ— æ³•ç›´æ¥è·³è½¬æ—¶å¯æ‰‹åŠ¨æœç´¢ï¼Œæˆ–å¤åˆ¶ç¾¤å·åŠ å…¥ï¼‰

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ™ è‡´è°¢

- [anki-apkg-export](https://github.com/repeat-space/anki-apkg-export) - Anki åŒ…å¯¼å‡ºåº“
- [react-markdown](https://github.com/remarkjs/react-markdown) - React Markdown æ¸²æŸ“
- [marked](https://github.com/markedjs/marked) - Markdown è§£æå™¨
- [Tauri](https://tauri.app/) - è·¨å¹³å°æ¡Œé¢åº”ç”¨æ¡†æ¶
- [sql.js](https://github.com/sql-js/sql.js) - SQLite Wasm å®ç°ï¼ˆç”¨äº .apkg å¯¼å…¥ï¼‰

---

**å¼€å§‹åˆ¶ä½œæ‚¨çš„Ankiå¡ç‰‡å§ï¼** ğŸ‰

è®¿é—® http://localhost:3000/ ç«‹å³ä½“éªŒã€‚
