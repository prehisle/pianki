# Pianki 使用指南

## 🚀 快速开始

### 1. 安装依赖（已完成）
```bash
npm install
```

### 2. 启动开发服务器（已启动）
```bash
npm run dev
```

这会同时启动前端和后端服务：
- 前端：http://localhost:3000/
- 后端：http://localhost:9908/

### 3. 访问应用
打开浏览器，访问 http://localhost:3000/

## ✨ 新功能亮点

### 📋 Markdown 编辑器（实时预览）
- **左右分栏设计**：左侧编辑，右侧实时预览
- 支持标准 Markdown 语法（粗体、斜体、标题、列表等）
- 表格、引用、代码块等高级格式
- 快捷工具栏：一键插入粗体、斜体、代码、图片
- 适合制作结构化学习卡片

### 📎 图片插入与粘贴
- **方式1**：点击工具栏"📷 插入图片"按钮
- **方式2**：直接在编辑器中按 Ctrl+V (Mac: Cmd+V) 粘贴图片
- 图片自动插入到光标位置的Markdown文本中
- 使用相对路径，更简洁可移植
- 支持混合文字和图片内容
- 告别独立图片区域，更灵活的排版

### 🎨 现代化界面
- **美观的确认对话框**：告别丑陋的浏览器默认弹窗
- 流畅的动画效果（淡入、滑出）
- 支持键盘操作（ESC关闭、Enter确认）
- 实时更新卡片计数
- 响应式设计，适配不同屏幕

## 📖 功能说明

### 创建牌组
1. 点击左侧边栏的 "➕" 按钮
2. 输入牌组名称
3. 新牌组会出现在列表中

### 创建卡片
1. 选择一个牌组
2. 点击"➕ 新建卡片"按钮
3. 在左右分栏的Markdown编辑器中编辑内容：
   - **左侧**：Markdown编辑区
     - 直接输入文字和Markdown格式
     - 使用工具栏快捷按钮（粗体、斜体、代码）
     - 点击"❓"查看Markdown语法帮助
   - **右侧**：实时预览区
     - 自动显示渲染后的效果
     - 所见即所得
   - **插入图片**：
     - 方式1：点击工具栏"📷 插入图片"按钮
     - 方式2：在编辑器中按 Ctrl+V (Mac: Cmd+V) 粘贴
     - 图片会自动以Markdown格式插入到光标位置
     - 支持格式：JPG、PNG、GIF、WebP
4. 点击"保存"

### 编辑卡片
1. 在卡片列表中点击"✏️ 编辑"按钮
2. 修改内容后点击"保存"

### 删除卡片
1. 在卡片列表中点击"🗑️ 删除"按钮
2. 在美观的确认对话框中点击"删除"
3. 提示：
   - 可以按 ESC 键取消
   - 点击对话框外部也能取消
   - 删除后卡片数量会自动更新

### 导出为 Anki 牌组
1. 选择要导出的牌组
2. 点击左侧边栏底部的"📦 导出为 .apkg"按钮
3. 下载生成的 .apkg 文件
4. 在 Android 手机的 Anki 应用中导入这个文件

## 📱 在 Android Anki 中导入

1. 将导出的 .apkg 文件传输到手机
2. 打开 Anki 应用
3. 点击"导入文件"
4. 选择刚才传输的 .apkg 文件
5. 导入完成后就可以开始学习了！

## 🗂️ 项目结构

```
pianki/
├── backend/          # 后端服务
│   ├── src/
│   │   ├── index.ts        # 入口文件
│   │   ├── database.ts     # 数据库配置
│   │   ├── types.ts        # TypeScript 类型定义
│   │   ├── anki-export.ts  # Anki 导出功能
│   │   └── routes/         # API 路由
│   ├── data/         # 数据库文件（自动生成）
│   └── uploads/      # 上传的图片（自动生成）
│
├── frontend/         # 前端应用
│   └── src/
│       ├── components/     # React 组件
│       ├── App.tsx         # 主应用组件
│       ├── api.ts          # API 调用
│       └── main.tsx        # 入口文件
│
└── package.json      # 根配置文件
```

## 🛠️ 技术栈

### 前端
- **框架**：React 18 + TypeScript + Vite
- **Markdown**：react-markdown + remark-gfm
- **HTTP客户端**：Axios
- **UI组件**：自定义组件（MarkdownEditor、ConfirmDialog等）

### 后端
- **运行时**：Node.js + Express + TypeScript
- **数据库**：SQLite
- **文件上传**：Multer
- **Markdown处理**：Marked
- **Anki 导出**：anki-apkg-export

## 📝 注意事项

1. **图片限制**：
   - 文件大小限制为 5MB
   - 支持格式：JPG, PNG, GIF, WebP
   - 图片使用相对路径存储（`/uploads/xxx.png`）

2. **数据存储**：
   - 数据库文件：`backend/data/pianki.db`
   - 旧版 JSON 迁移备份：`backend/data/db.json.bak-*`
   - 上传图片：`backend/uploads/` 目录
   - 请勿删除这些目录和文件

3. **Markdown支持**：
   - 卡片文字支持完整 Markdown 语法
   - 导出到 Anki 时自动转换为 HTML
   - 图片会自动打包进 .apkg 文件

4. **实时更新**：
   - 新建/删除卡片后，牌组卡片数量会立即更新
   - 无需手动刷新页面

## 🔧 其他命令

```bash
# 仅启动后端
npm run dev:backend

# 仅启动前端
npm run dev:frontend

# 构建生产版本
npm run build

# 启动生产服务器
npm start
```

## 💡 Markdown 使用示例

### 基础语法
```markdown
# 一级标题
## 二级标题

**粗体文字**  *斜体文字*  ~~删除线~~

- 列表项 1
- 列表项 2

1. 有序列表 1
2. 有序列表 2

> 这是引用文本

`代码片段`

\`\`\`
代码块
\`\`\`

[链接文字](https://example.com)
```

### 插入图片
```markdown
# 问题：什么是React？

React是一个用于构建用户界面的JavaScript库。

![React Logo](图片URL)

## 特点
- 声明式
- 组件化
- 一次学习，随处编写
```

在实际使用中，您只需要：
1. 在编辑器中输入文字
2. 点击"插入图片"或粘贴图片
3. 图片会自动插入为`![图片](URL)`格式
4. 右侧预览会立即显示效果

## ❓ 常见问题

**Q: 如何备份我的数据？**
A: 复制 `backend/data/pianki.db` 文件、`backend/data/db.json.bak-*`（若存在）以及 `backend/uploads/` 目录即可。

**Q: 导出的 .apkg 文件在 Anki 中显示异常？**
A: 请确保图片文件格式正确，且文件大小合适。Markdown 格式会被正确转换为 HTML。

**Q: 如何添加更多牌组？**
A: 点击左侧边栏的 "➕" 按钮即可创建新牌组。

**Q: 如何快速插入图片？**
A: 在编辑卡片时，有两种方式：
   1. 点击编辑器工具栏的"📷 插入图片"按钮
   2. 在编辑器中按 Ctrl+V (Mac: Cmd+V) 粘贴剪贴板中的图片
   图片会自动以Markdown格式插入到光标位置。

**Q: 左侧编辑右侧预览是实时的吗？**
A: 是的！当您在左侧编辑时，右侧预览会实时更新，让您立即看到渲染效果。

**Q: Markdown 预览和实际在 Anki 中的显示一样吗？**
A: 基本一样。应用会将 Markdown 转换为 HTML 并导出到 Anki，包括文字格式和图片都会正确显示。

**Q: 图片可以和文字混排吗？**
A: 可以！图片以Markdown格式（`![图片](URL)`）插入到文本中，您可以在任意位置插入图片，实现灵活的排版。

**Q: 为什么删除时的对话框这么好看？**
A: 我们自定义了确认对话框，替代了浏览器默认的丑陋弹窗。您可以：
   - 点击"取消"或按 ESC 键取消删除
   - 点击对话框外部也能取消
   - 享受流畅的动画效果

**Q: 牌组的卡片数量会自动更新吗？**
A: 会的！新建或删除卡片后，左侧牌组列表的卡片数量会立即更新，无需刷新页面。

## 🎉 开始使用

现在您可以：
1. 访问 http://localhost:3000/
2. 开始创建您的第一张卡片
3. 导出并在 Anki 中学习

祝学习愉快！📚
